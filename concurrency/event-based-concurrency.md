# 第三十三章-基于事件的并发（进阶）

到目前为止所讨论的并发，都只能通过线程来实现。但其实在图形界面（GUI）、某些网络服务器中，常常采用另一种并发方式——基于事件的并发（event-based concurrency），在一些现代系统中较为流行，比如 `node.js`，但它源自于 C/UNIX 系统，我们下面将讨论。

「基于事件的并发」主要针对两方面的问题：

1. 多线程应用中，正确处理并发很有难度。 正如我们讨论的，忘加锁、死锁和其他烦人的问题会发生。
2. 开发者无法控制多线程在某一时刻的调度(由系统调度)。

> 关键问题：不用线程，如何构建并发服务器？不用线程，同时保证对并发的控制，避免多线程应用中出现的问题，我们应该如何构建一个并发服务器？



### 基本想法：事件循环

我们使用的基本方法就是「**基于事件的并发**」（event-based concurrency）。该方法很简单：我们等待某事（即“事件”）发生；当它发生时，检查事件类型，然后做少量的相应工作（可能是 I/O 请求，或者调度其他事件准备后续处理）。

这种应用都是基于一个简单的结构，称为**事件循环**（event loop）:

```c
while (1) {
    events = getEvents();
    for (e in events)
    processEvent(e);
}
```

**主循环等待某些事件发生**（通过 getEvents()调用），然后依次处理这些发生的事件。处理事件的代码叫作事件处理程序（event handler）。重要的是，处理程序在处理一个事件时，它是系统中发生的唯一活动。因此，调度就是决定接下来处理哪个事件。这种对调度的显式控制，是基于事件方法的一个重要优点。

\














\
